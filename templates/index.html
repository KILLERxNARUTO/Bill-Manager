<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rifa Appliances - Billing System</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background-color: #f8f9fa;
        }
        .container {
            max-width: 1200px;
            margin-top: 30px;
        }
        .card {
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
        }
        .btn-add-row {
            background-color: #28a745;
            color: white;
        }
        .btn-remove-row {
            background-color: #dc3545;
            color: white;
        }
        .product-table {
            overflow-x: auto;
        }
        .header-section {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 10px 10px 0 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="card">
            <div class="header-section">
                <h1 class="text-center mb-2">Rifa Appliances</h1>
                <p class="text-center mb-0">Invoice Generation System</p>
            </div>
            
            <div class="card-body p-4">
                <form action="/generate_invoice" method="POST" id="invoiceForm">
                    <!-- Invoice Metadata -->
                    <div class="row mb-4">
                        <div class="col-md-6">
                            <label class="form-label fw-bold">Invoice Number</label>
                            <input type="text" class="form-control" name="invoice_number" required>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label fw-bold">Invoice Date</label>
                            <input type="date" class="form-control" name="invoice_date" required>
                        </div>
                    </div>

                    <!-- Customer Details -->
                    <div class="row mb-4">
                        <div class="col-md-6">
                            <h5 class="mb-3 text-primary">Bill To</h5>
                            <div class="mb-2">
                                <label class="form-label">Name</label>
                                <input type="text" class="form-control" name="bill_name" required>
                            </div>
                            <div class="mb-2">
                                <label class="form-label">Address</label>
                                <textarea class="form-control" name="bill_address" rows="2" required></textarea>
                            </div>
                            <div class="row">
                                <div class="col-md-6 mb-2">
                                    <label class="form-label">City</label>
                                    <input type="text" class="form-control" name="bill_city" required>
                                </div>
                                <div class="col-md-6 mb-2">
                                    <label class="form-label">State</label>
                                    <input type="text" class="form-control" name="bill_state" required>
                                </div>
                            </div>
                            <div class="mb-2">
                                <label class="form-label">Pincode</label>
                                <input type="text" class="form-control" name="bill_pincode" required>
                            </div>
                        </div>

                        <div class="col-md-6">
                            <h5 class="mb-3 text-primary">Ship To</h5>
                            <div class="mb-2">
                                <label class="form-label">Name</label>
                                <input type="text" class="form-control" name="ship_name" required>
                            </div>
                            <div class="mb-2">
                                <label class="form-label">Address</label>
                                <textarea class="form-control" name="ship_address" rows="2" required></textarea>
                            </div>
                            <div class="row">
                                <div class="col-md-6 mb-2">
                                    <label class="form-label">City</label>
                                    <input type="text" class="form-control" name="ship_city" required>
                                </div>
                                <div class="col-md-6 mb-2">
                                    <label class="form-label">State</label>
                                    <input type="text" class="form-control" name="ship_state" required>
                                </div>
                            </div>
                            <div class="mb-2">
                                <label class="form-label">Pincode</label>
                                <input type="text" class="form-control" name="ship_pincode" required>
                            </div>
                        </div>
                    </div>

                    <!-- Tax Rate -->
                    <div class="row mb-4">
                        <div class="col-md-4">
                            <label class="form-label fw-bold">Tax Rate (% for both CGST & SGST)</label>
                            <input type="number" class="form-control" name="tax_rate" value="9" step="0.01" required>
                        </div>
                    </div>

                    <!-- Product Table -->
                    <h5 class="mb-3 text-primary">Product Details</h5>
                    <div class="product-table mb-3">
                        <table class="table table-bordered" id="productTable">
                            <thead class="table-dark">
                                <tr>
                                    <th style="width: 5%">#</th>
                                    <th style="width: 40%">Item Description</th>
                                    <th style="width: 15%">HSN/SAC</th>
                                    <th style="width: 10%">Qty</th>
                                    <th style="width: 15%">Rate</th>
                                    <th style="width: 15%">Amount</th>
                                    <th style="width: 5%">Action</th>
                                </tr>
                            </thead>
                            <tbody id="productTableBody">
                                <tr class="product-row">
                                    <td class="row-number">1</td>
                                    <td><input type="text" class="form-control" name="description[]" required></td>
                                    <td><input type="text" class="form-control" name="hsn[]" required></td>
                                    <td><input type="number" class="form-control qty-input" name="qty[]" step="0.01" required></td>
                                    <td><input type="number" class="form-control rate-input" name="rate[]" step="0.01" required></td>
                                    <td><input type="text" class="form-control amount-display" readonly></td>
                                    <td><button type="button" class="btn btn-sm btn-remove-row" onclick="removeRow(this)">×</button></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <button type="button" class="btn btn-add-row mb-4" onclick="addRow()">+ Add Item</button>

                    <!-- Payment Details -->
                    <div class="row mb-4">
                        <div class="col-md-4">
                            <label class="form-label fw-bold">Payment Made</label>
                            <input type="number" class="form-control" name="payment_made" value="0" step="0.01">
                        </div>
                    </div>

                    <!-- Submit Button -->
                    <div class="text-center">
                        <button type="submit" class="btn btn-primary btn-lg px-5">Generate Invoice PDF</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        let rowCount = 1;

        function addRow() {
            rowCount++;
            const tableBody = document.getElementById('productTableBody');
            const newRow = document.createElement('tr');
            newRow.className = 'product-row';
            newRow.innerHTML = `
                <td class="row-number">${rowCount}</td>
                <td><input type="text" class="form-control" name="description[]" required></td>
                <td><input type="text" class="form-control" name="hsn[]" required></td>
                <td><input type="number" class="form-control qty-input" name="qty[]" step="0.01" required></td>
                <td><input type="number" class="form-control rate-input" name="rate[]" step="0.01" required></td>
                <td><input type="text" class="form-control amount-display" readonly></td>
                <td><button type="button" class="btn btn-sm btn-remove-row" onclick="removeRow(this)">×</button></td>
            `;
            tableBody.appendChild(newRow);
            
            // Add event listeners to new row
            const qtyInput = newRow.querySelector('.qty-input');
            const rateInput = newRow.querySelector('.rate-input');
            qtyInput.addEventListener('input', updateRowAmount);
            rateInput.addEventListener('input', updateRowAmount);
        }

        function removeRow(button) {
            const row = button.closest('tr');
            row.remove();
            updateRowNumbers();
        }

        function updateRowNumbers() {
            const rows = document.querySelectorAll('.product-row');
            rows.forEach((row, index) => {
                row.querySelector('.row-number').textContent = index + 1;
            });
            rowCount = rows.length;
        }

        function updateRowAmount(event) {
            const row = event.target.closest('tr');
            const qty = parseFloat(row.querySelector('.qty-input').value) || 0;
            const rate = parseFloat(row.querySelector('.rate-input').value) || 0;
            const amount = qty * rate;
            row.querySelector('.amount-display').value = amount.toFixed(2);
        }

        // Add event listeners to initial row
        document.addEventListener('DOMContentLoaded', function() {
            const qtyInputs = document.querySelectorAll('.qty-input');
            const rateInputs = document.querySelectorAll('.rate-input');
            
            qtyInputs.forEach(input => {
                input.addEventListener('input', updateRowAmount);
            });
            
            rateInputs.forEach(input => {
                input.addEventListener('input', updateRowAmount);
            });

            // Set today's date as default
            const today = new Date().toISOString().split('T')[0];
            document.querySelector('input[name="invoice_date"]').value = today;
        });
    </script>
</body>
</html>